[{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\api\\auth\\login\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\api\\auth\\signup\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\api\\records\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\api\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\api\\users\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\app\\page.js","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  15 |   useEffect(() => {\n  16 |     const savedTheme = localStorage.getItem('tracker_theme') || 'light';\n> 17 |     setTheme(savedTheme);\n     |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |     if (savedTheme === 'dark') {\n  19 |       document.body.classList.add('dark');\n  20 |     } else {","line":17,"column":5,"nodeType":null,"endLine":17,"endColumn":13},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  40 |     if (saved) {\n  41 |       try {\n> 42 |         setUser(JSON.parse(saved));\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  43 |       } catch (e) {\n  44 |         localStorage.removeItem('tracker_user');\n  45 |       }","line":42,"column":9,"nodeType":null,"endLine":42,"endColumn":16}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\nimport { useState, useEffect } from 'react';\nimport LoginForm from '@/components/LoginForm';\nimport AdminDashboard from '@/components/AdminDashboard';\nimport SignupForm from '@/components/SignupForm';\nimport MemberDashboard from '@/components/MemberDashboard';\nimport ZonalManagerDashboard from '@/components/ZonalManagerDashboard';\n\nexport default function Home() {\n  const [user, setUser] = useState(null);\n  const [view, setView] = useState('login'); // login, signup\n  const [theme, setTheme] = useState('light');\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem('tracker_theme') || 'light';\n    setTheme(savedTheme);\n    if (savedTheme === 'dark') {\n      document.body.classList.add('dark');\n    } else {\n      document.body.classList.remove('dark');\n    }\n  }, [theme]);\n\n  const toggleTheme = () => {\n    const newTheme = theme === 'light' ? 'dark' : 'light';\n    setTheme(newTheme);\n    localStorage.setItem('tracker_theme', newTheme);\n    if (newTheme === 'dark') {\n      document.body.classList.add('dark');\n    } else {\n      document.body.classList.remove('dark');\n    }\n  };\n\n  useEffect(() => {\n    // Check local storage for persistent login\n    // In a real app, we would verify the token with the server here\n    const saved = localStorage.getItem('tracker_user');\n    if (saved) {\n      try {\n        setUser(JSON.parse(saved));\n      } catch (e) {\n        localStorage.removeItem('tracker_user');\n      }\n    }\n\n    // Check if URL has a query for signup (e.g. invite links later)\n  }, []);\n\n  const handleLogin = (userData) => {\n    setUser(userData);\n    localStorage.setItem('tracker_user', JSON.stringify(userData));\n  };\n\n  const handleLogout = () => {\n    setUser(null);\n    localStorage.removeItem('tracker_user');\n    setView('login');\n  };\n\n  // Main Render Logic\n  if (user) {\n    if (user.role === 'admin' || user.role === 'head') {\n      return <AdminDashboard user={user} onLogout={handleLogout} theme={theme} toggleTheme={toggleTheme} />;\n    }\n    if (user.role === 'zonal_manager') {\n      return <ZonalManagerDashboard user={user} onLogout={handleLogout} theme={theme} toggleTheme={toggleTheme} />;\n    }\n    return <MemberDashboard user={user} onLogout={handleLogout} theme={theme} toggleTheme={toggleTheme} />;\n  }\n\n  if (view === 'signup') {\n    return (\n      <SignupForm\n        onSignup={() => {\n          setView('login');\n          // Optionally auto-login or show success message\n          alert('Account created! Please login.');\n        }}\n        onSwitch={() => setView('login')}\n        theme={theme}\n        toggleTheme={toggleTheme}\n      />\n    );\n  }\n\n  return <LoginForm onLogin={handleLogin} onSwitch={() => setView('signup')} theme={theme} toggleTheme={toggleTheme} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\components\\AdminDashboard.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStats'. Either include it or remove the dependency array.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [tab, filterDate, fetchStats]","fix":{"range":[1170,1187],"text":"[tab, filterDate, fetchStats]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport { Bar } from 'react-chartjs-2';\r\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend, ArcElement } from 'chart.js';\r\nimport { MapPin, Briefcase, Calendar, BarChart2, Settings, LogOut, Shield, Sun, Moon } from 'lucide-react';\r\n\r\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend, ArcElement);\r\n\r\nexport default function AdminDashboard({ user, onLogout, theme, toggleTheme }) {\r\n    const [tab, setTab] = useState('overview'); // overview, zone, branch, users\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [filterDate, setFilterDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    // User Management State\r\n    const [allUsers, setAllUsers] = useState([]);\r\n    const [editingUser, setEditingUser] = useState(null);\r\n    const [editForm, setEditForm] = useState({ zone: '', branch: '', managed_locations: '[]' });\r\n\r\n    useEffect(() => {\r\n        if (tab === 'users') {\r\n            fetchUsers();\r\n        } else {\r\n            fetchStats();\r\n        }\r\n    }, [tab, filterDate]);\r\n\r\n    const fetchStats = async () => {\r\n        setLoading(true);\r\n        try {\r\n            let url = `/api/stats?date=${filterDate}`;\r\n            if (user.role === 'zonal_manager') {\r\n                url += `&zone=${user.zone}`;\r\n            }\r\n            if (tab === 'zone') url += '&type=zone';\r\n            if (tab === 'branch') url += '&type=branch';\r\n\r\n            const res = await fetch(url);\r\n            const d = await res.json();\r\n            if (Array.isArray(d)) setData(d);\r\n            else setData([]);\r\n        } catch (e) {\r\n            console.error(e);\r\n            setData([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchUsers = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch('/api/users');\r\n            const d = await res.json();\r\n            setAllUsers(Array.isArray(d) ? d : []);\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleEditUser = (u) => {\r\n        setEditingUser(u.id);\r\n        const locs = u.managed_locations || '[]';\r\n        setEditForm({\r\n            zone: u.zone || '',\r\n            branch: u.branch || '',\r\n            managed_locations: locs\r\n        });\r\n    };\r\n\r\n    const saveUser = async (id) => {\r\n        try {\r\n            await fetch('/api/users', {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ id, ...editForm })\r\n            });\r\n            setEditingUser(null);\r\n            fetchUsers();\r\n        } catch (e) {\r\n            alert('Failed to save');\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (val) => {\r\n        return new Intl.NumberFormat('en-LK', { style: 'currency', currency: 'LKR', minimumFractionDigits: 0 }).format(val);\r\n    };\r\n\r\n    // Chart Logic\r\n    const labels = data.map(i => tab === 'zone' ? i.zone : (tab === 'branch' ? i.branch : i.username));\r\n    const values = data.map(i => i.total_business || i.actual_business || 0);\r\n\r\n    const barData = {\r\n        labels,\r\n        datasets: [{\r\n            label: 'New Business (LKR)',\r\n            data: values,\r\n            backgroundColor: '#3b82f6', // Blue 500\r\n            borderRadius: 4,\r\n        }],\r\n    };\r\n\r\n    const chartOptions = {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n            legend: { display: false },\r\n        },\r\n        scales: {\r\n            y: {\r\n                beginAtZero: true,\r\n                grid: { color: 'var(--border)' },\r\n                ticks: { color: 'var(--text-muted)' }\r\n            },\r\n            x: {\r\n                grid: { display: false },\r\n                ticks: { color: 'var(--text-muted)' }\r\n            }\r\n        }\r\n    };\r\n\r\n    const totalBusiness = data.reduce((acc, curr) => acc + (curr.total_business || curr.actual_business || 0), 0);\r\n    const activeAgents = tab === 'overview' ? data.length : data.reduce((acc, curr) => acc + (curr.agents || 0), 0);\r\n\r\n    return (\r\n        <div style={{ minHeight: '100vh', background: 'var(--bg-body)' }}>\r\n            {/* Header */}\r\n            <header className=\"dashboard-header\" style={{ background: 'var(--bg-card)' }}>\r\n                <div>\r\n                    <h1 className=\"text-h1\">Daily Business Tracker</h1>\r\n                    <p className=\"text-muted\">Administrator Dashboard</p>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>\r\n                    <button\r\n                        onClick={toggleTheme}\r\n                        className=\"btn-secondary\"\r\n                        style={{ padding: '0.5rem', borderRadius: '50%', width: '40px', height: '40px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n                    >\r\n                        {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}\r\n                    </button>\r\n\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'rgba(59, 130, 246, 0.1)', padding: '0.5rem 1rem', borderRadius: '20px', color: 'var(--accent-blue)' }}>\r\n                        <Shield size={16} />\r\n                        <span style={{ fontSize: '0.85rem', fontWeight: 600 }}>System Admin</span>\r\n                    </div>\r\n\r\n                    <div style={{ textAlign: 'right' }}>\r\n                        <div style={{ fontSize: '0.9rem', fontWeight: 600 }}>{user.username}</div>\r\n                        <div style={{ fontSize: '0.75rem', color: '#6b7280' }}>Administrator</div>\r\n                    </div>\r\n\r\n                    <button onClick={onLogout} className=\"btn-secondary\" style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                        <LogOut size={16} /> Logout\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem' }}>\r\n\r\n                {/* Tabs */}\r\n                <div className=\"nav-tabs\">\r\n                    <button onClick={() => setTab('overview')} className={`nav-tab ${tab === 'overview' ? 'active' : ''}`}>\r\n                        <BarChart2 size={18} /> Overview\r\n                    </button>\r\n                    <button onClick={() => setTab('zone')} className={`nav-tab ${tab === 'zone' ? 'active' : ''}`}>\r\n                        <MapPin size={18} /> Zone Performance\r\n                    </button>\r\n                    <button onClick={() => setTab('branch')} className={`nav-tab ${tab === 'branch' ? 'active' : ''}`}>\r\n                        <Briefcase size={18} /> Branch Performance\r\n                    </button>\r\n                    {(user.role === 'admin' || user.role === 'head') && (\r\n                        <button onClick={() => setTab('users')} className={`nav-tab ${tab === 'users' ? 'active' : ''}`}>\r\n                            <Settings size={18} /> Manage Users\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {tab !== 'users' && (\r\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '1.5rem' }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'white', padding: '0.5rem 1rem', borderRadius: '8px', border: '1px solid #e5e7eb', boxShadow: '0 1px 2px rgba(0,0,0,0.05)' }}>\r\n                            <Calendar size={18} color=\"#6b7280\" />\r\n                            <input\r\n                                type=\"date\"\r\n                                value={filterDate}\r\n                                onChange={(e) => setFilterDate(e.target.value)}\r\n                                style={{ border: 'none', outline: 'none', fontSize: '0.9rem', color: '#374151' }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {tab === 'users' ? (\r\n                    <div className=\"clean-card animate-fade-in\">\r\n                        <div className=\"card-header-accent\">\r\n                            <h2 className=\"text-h2\">User Management</h2>\r\n                            <p className=\"text-muted\">Manage system access, roles, and branch allocations</p>\r\n                        </div>\r\n\r\n                        <div style={{ overflowX: 'auto' }}>\r\n                            <table className=\"clean-table\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>Username</th>\r\n                                        <th>Role</th>\r\n                                        <th>Allocations / Zone</th>\r\n                                        <th>Details / Branch</th>\r\n                                        <th>Actions</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {allUsers.map(u => (\r\n                                        <tr key={u.id}>\r\n                                            <td style={{ fontWeight: 600 }}>{u.username}</td>\r\n                                            <td>\r\n                                                <span style={{ fontSize: '0.75rem', padding: '0.2rem 0.5rem', background: '#f3f4f6', borderRadius: '4px', color: '#4b5563', textTransform: 'capitalize' }}>\r\n                                                    {u.role.replace('_', ' ')}\r\n                                                </span>\r\n                                            </td>\r\n\r\n                                            {/* Zone/Allocations */}\r\n                                            <td>\r\n                                                {editingUser === u.id ? (\r\n                                                    u.role === 'zonal_manager' ? (\r\n                                                        <div style={{ fontSize: '0.85rem' }}>\r\n                                                            <div style={{ marginBottom: '0.5rem', fontWeight: 600 }}>Allocated Branches:</div>\r\n                                                            <div style={{ border: '1px solid #e5e7eb', borderRadius: '6px', padding: '0.5rem', marginBottom: '0.5rem', maxHeight: '120px', overflowY: 'auto' }}>\r\n                                                                {(editForm.managed_locations ? JSON.parse(editForm.managed_locations) : []).map((loc, idx) => (\r\n                                                                    <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', padding: '0.25rem 0', borderBottom: '1px dashed #f3f4f6' }}>\r\n                                                                        <span>{loc.zone} - {loc.branch}</span>\r\n                                                                        <button onClick={() => {\r\n                                                                            const current = JSON.parse(editForm.managed_locations);\r\n                                                                            const newLocs = current.filter((_, i) => i !== idx);\r\n                                                                            setEditForm({ ...editForm, managed_locations: JSON.stringify(newLocs) });\r\n                                                                        }} style={{ color: '#ef4444', border: 'none', background: 'none', cursor: 'pointer' }}>├ù</button>\r\n                                                                    </div>\r\n                                                                ))}\r\n                                                                {(editForm.managed_locations ? JSON.parse(editForm.managed_locations) : []).length === 0 && <span style={{ opacity: 0.5 }}>No allocations</span>}\r\n                                                            </div>\r\n                                                            <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                                                                <input id={`z-${u.id}`} placeholder=\"Zone\" className=\"clean-input\" style={{ padding: '0.25rem' }} />\r\n                                                                <input id={`b-${u.id}`} placeholder=\"Branch\" className=\"clean-input\" style={{ padding: '0.25rem' }} />\r\n                                                                <button onClick={() => {\r\n                                                                    const z = document.getElementById(`z-${u.id}`).value;\r\n                                                                    const b = document.getElementById(`b-${u.id}`).value;\r\n                                                                    if (z && b) {\r\n                                                                        const current = JSON.parse(editForm.managed_locations || '[]');\r\n                                                                        current.push({ zone: z, branch: b });\r\n                                                                        setEditForm({ ...editForm, managed_locations: JSON.stringify(current) });\r\n                                                                        document.getElementById(`z-${u.id}`).value = '';\r\n                                                                        document.getElementById(`b-${u.id}`).value = '';\r\n                                                                    }\r\n                                                                }} style={{ background: '#3b82f6', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', padding: '0 0.5rem' }}>+</button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    ) : (\r\n                                                        <input\r\n                                                            className=\"clean-input\"\r\n                                                            value={editForm.zone}\r\n                                                            onChange={(e) => setEditForm({ ...editForm, zone: e.target.value })}\r\n                                                            placeholder=\"Zone\"\r\n                                                        />\r\n                                                    )\r\n                                                ) : (\r\n                                                    u.role === 'zonal_manager' ? (\r\n                                                        <span style={{ color: '#6b7280' }}>\r\n                                                            {(u.managed_locations ? JSON.parse(u.managed_locations).length : 0)} Branches\r\n                                                        </span>\r\n                                                    ) : (u.zone || '-')\r\n                                                )}\r\n                                            </td>\r\n\r\n                                            {/* Branch */}\r\n                                            <td>\r\n                                                {editingUser === u.id && u.role !== 'zonal_manager' ? (\r\n                                                    <input\r\n                                                        className=\"clean-input\"\r\n                                                        value={editForm.branch}\r\n                                                        onChange={(e) => setEditForm({ ...editForm, branch: e.target.value })}\r\n                                                        placeholder=\"Branch\"\r\n                                                    />\r\n                                                ) : u.role !== 'zonal_manager' ? (u.branch || '-') : '-'}\r\n                                            </td>\r\n\r\n                                            <td>\r\n                                                {editingUser === u.id ? (\r\n                                                    <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                                                        <button onClick={() => saveUser(u.id)} style={{ color: '#059669', background: 'none', border: 'none', cursor: 'pointer', fontWeight: 600 }}>Save</button>\r\n                                                        <button onClick={() => setEditingUser(null)} style={{ color: '#dc2626', background: 'none', border: 'none', cursor: 'pointer' }}>Cancel</button>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <button onClick={() => handleEditUser(u)} style={{ color: '#3b82f6', background: 'none', border: 'none', cursor: 'pointer', fontWeight: 500 }}>Edit</button>\r\n                                                )}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* KPI Cards */}\r\n                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem', marginBottom: '2rem' }}>\r\n                            <div className=\"clean-card\" style={{ padding: '1.5rem' }}>\r\n                                <div style={{ fontSize: '0.85rem', color: '#6b7280' }}>Total Business Today</div>\r\n                                <div style={{ fontSize: '1.75rem', fontWeight: 700, color: '#111827', marginTop: '0.5rem' }}>\r\n                                    {formatCurrency(totalBusiness)}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"clean-card\" style={{ padding: '1.5rem' }}>\r\n                                <div style={{ fontSize: '0.85rem', color: '#6b7280' }}>Active Units/Agents</div>\r\n                                <div style={{ fontSize: '1.75rem', fontWeight: 700, color: '#111827', marginTop: '0.5rem' }}>\r\n                                    {activeAgents}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Chart */}\r\n                        <div className=\"clean-card animate-fade-in\" style={{ height: '400px', marginBottom: '2rem' }}>\r\n                            <h3 className=\"text-h2\" style={{ marginBottom: '1.5rem' }}>Performance Trends</h3>\r\n                            {data.length > 0 ? (\r\n                                <Bar data={barData} options={chartOptions} />\r\n                            ) : (\r\n                                <div style={{ height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#9ca3af' }}>No data available</div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Data Table */}\r\n                        <div className=\"clean-card animate-fade-in\">\r\n                            <h3 className=\"text-h2\" style={{ marginBottom: '1.5rem' }}>Detailed Breakdown</h3>\r\n                            <table className=\"clean-table\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>{tab === 'zone' ? 'Zone' : (tab === 'branch' ? 'Branch' : 'Agent')}</th>\r\n                                        <th>{tab === 'overview' ? 'Plan' : 'Count'}</th>\r\n                                        <th>Business (LKR)</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {data.map((item, idx) => (\r\n                                        <tr key={idx}>\r\n                                            <td style={{ fontWeight: 500 }}>\r\n                                                {tab === 'zone' ? item.zone : (tab === 'branch' ? item.branch : item.username)}\r\n                                            </td>\r\n                                            <td style={{ color: '#6b7280' }}>\r\n                                                {tab === 'overview' ? (item.morning_plan || '-') : (item.agents + ' active')}\r\n                                            </td>\r\n                                            <td style={{ fontWeight: 600, color: (item.total_business || item.actual_business) > 0 ? '#059669' : '#374151' }}>\r\n                                                {formatCurrency(item.total_business || item.actual_business || 0)}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                    {data.length === 0 && <tr><td colSpan=\"3\" style={{ textAlign: 'center', color: '#9ca3af', padding: '2rem' }}>No records</td></tr>}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\components\\LoginForm.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":102,"column":24,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4468,4512],"text":"\r\n                    Don&apos;t have an account?"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4468,4512],"text":"\r\n                    Don&lsquo;t have an account?"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4468,4512],"text":"\r\n                    Don&#39;t have an account?"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4468,4512],"text":"\r\n                    Don&rsquo;t have an account?"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { Sun, Moon } from 'lucide-react';\r\n\r\nexport default function LoginForm({ onLogin, onSwitch, theme, toggleTheme }) {\r\n    const [username, setUsername] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const res = await fetch('/api/auth/login', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ username, password })\r\n            });\r\n            const data = await res.json();\r\n\r\n            if (data.error) throw new Error(data.error);\r\n\r\n            onLogin(data.user);\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', background: 'var(--bg-body)', position: 'relative' }}>\r\n            {/* Theme Toggle */}\r\n            <button\r\n                onClick={toggleTheme}\r\n                className=\"btn-secondary\"\r\n                style={{ position: 'absolute', top: '2rem', right: '2rem', borderRadius: '50%', width: '44px', height: '44px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n            >\r\n                {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}\r\n            </button>\r\n\r\n            <div className=\"clean-card animate-fade-in\" style={{ padding: '3rem', width: '100%', maxWidth: '440px', background: 'var(--bg-card)' }}>\r\n                <h2 className=\"text-h1\" style={{ marginBottom: '1rem', textAlign: 'left', color: 'var(--text-main)' }}>\r\n                    Business Tracker Login\r\n                </h2>\r\n                <p className=\"text-muted\" style={{ marginBottom: '2.5rem', textAlign: 'left' }}>\r\n                    Sign in to access your daily business tracker\r\n                </p>\r\n\r\n                {error && (\r\n                    <div style={{\r\n                        background: '#fef2f2',\r\n                        border: '1px solid #fee2e2',\r\n                        color: '#b91c1c',\r\n                        padding: '0.75rem',\r\n                        borderRadius: '6px',\r\n                        marginBottom: '1.5rem',\r\n                        fontSize: '0.9rem'\r\n                    }}>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n                    <div>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>\r\n                            Username or Company Email\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"clean-input\"\r\n                            value={username}\r\n                            onChange={(e) => setUsername(e.target.value)}\r\n                            required\r\n                            placeholder=\"your.email@company.com\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>\r\n                            Password\r\n                        </label>\r\n                        <input\r\n                            type=\"password\"\r\n                            className=\"clean-input\"\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            required\r\n                            placeholder=\"Enter your password\"\r\n                        />\r\n                    </div>\r\n\r\n                    <button type=\"submit\" className=\"btn-primary\" style={{ marginTop: '0.5rem', height: '48px', fontSize: '1rem' }} disabled={loading}>\r\n                        {loading ? 'Verifying...' : 'Sign In'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div style={{ marginTop: '2.5rem', textAlign: 'center', fontSize: '0.9rem', color: '#6b7280' }}>\r\n                    Don't have an account?{' '}\r\n                    <button\r\n                        onClick={onSwitch}\r\n                        className=\"text-link\"\r\n                        style={{ background: 'none', border: 'none', padding: 0, font: 'inherit' }}\r\n                    >\r\n                        Create Account\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\components\\MemberDashboard.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchHistory' and 'fetchRecord'. Either include them or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [date, activeTab, fetchRecord, fetchHistory]","fix":{"range":[745,762],"text":"[date, activeTab, fetchRecord, fetchHistory]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport { Sun, Moon, BarChart2, Save, LogOut, Calendar, User } from 'lucide-react';\r\n\r\nexport default function MemberDashboard({ user, onLogout, theme, toggleTheme }) {\r\n    const [activeTab, setActiveTab] = useState('plan'); // plan, achievement, history\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [record, setRecord] = useState({ morning_plan: '', actual_business: '' });\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [history, setHistory] = useState([]);\r\n\r\n    useEffect(() => {\r\n        fetchRecord();\r\n        if (activeTab === 'history') fetchHistory();\r\n    }, [date, activeTab]);\r\n\r\n    const fetchRecord = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/records?userId=${user.id}&date=${date}`);\r\n            const data = await res.json();\r\n            if (data.id) {\r\n                setRecord(data);\r\n            } else {\r\n                setRecord({ morning_plan: '', actual_business: '' });\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchHistory = async () => {\r\n        try {\r\n            const res = await fetch(`/api/records?userId=${user.id}`);\r\n            const data = await res.json();\r\n            setHistory(Array.isArray(data) ? data : []);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            const res = await fetch('/api/records', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    user_id: user.id,\r\n                    date,\r\n                    morning_plan: record.morning_plan,\r\n                    actual_business: parseFloat(record.actual_business) || 0\r\n                })\r\n            });\r\n            if (res.ok) {\r\n                alert('Saved successfully!');\r\n                fetchRecord(); // Refresh to ensure sync\r\n            } else {\r\n                alert('Failed to save.');\r\n            }\r\n        } catch (e) {\r\n            alert('Error saving.');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (val) => {\r\n        return new Intl.NumberFormat('en-LK', { style: 'currency', currency: 'LKR', minimumFractionDigits: 0 }).format(val);\r\n    };\r\n\r\n    return (\r\n        <div style={{ minHeight: '100vh', background: 'var(--bg-body)' }}>\r\n            {/* Header */}\r\n            <header className=\"dashboard-header\" style={{ background: 'var(--bg-card)' }}>\r\n                <div>\r\n                    <h1 className=\"text-h1\">Daily Business Tracker</h1>\r\n                    <p className=\"text-muted\">Member Performance Portal</p>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>\r\n                    <button\r\n                        onClick={toggleTheme}\r\n                        className=\"btn-secondary\"\r\n                        style={{ padding: '0.5rem', borderRadius: '50%', width: '40px', height: '40px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n                    >\r\n                        {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}\r\n                    </button>\r\n\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'rgba(59, 130, 246, 0.1)', padding: '0.5rem 1rem', borderRadius: '20px', color: 'var(--accent-blue)' }}>\r\n                        <User size={16} />\r\n                        <span style={{ fontSize: '0.85rem', fontWeight: 600 }}>Team Member</span>\r\n                    </div>\r\n\r\n                    <div style={{ textAlign: 'right' }}>\r\n                        <div style={{ fontSize: '0.9rem', fontWeight: 600 }}>{user.username}</div>\r\n                        <div style={{ fontSize: '0.75rem', color: '#6b7280' }}>\r\n                            {user.branch ? user.branch : 'No Branch'} ΓÇó {user.zone ? user.zone : 'No Zone'}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={onLogout}\r\n                        className=\"btn-secondary\"\r\n                        style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 0.75rem' }}\r\n                    >\r\n                        <LogOut size={16} /> Logout\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <main style={{ maxWidth: '1000px', margin: '0 auto', padding: '2rem' }}>\r\n\r\n                {/* Tabs */}\r\n                <div className=\"nav-tabs\">\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'plan' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('plan')}\r\n                    >\r\n                        <Sun size={18} /> Morning - Plan\r\n                    </button>\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'achievement' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('achievement')}\r\n                    >\r\n                        <Moon size={18} /> Evening - Achievement\r\n                    </button>\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'history' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('history')}\r\n                    >\r\n                        <BarChart2 size={18} /> History\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"clean-card animate-fade-in\">\r\n                    <div className=\"card-header-accent\">\r\n                        <h2 className=\"text-h2\">\r\n                            {activeTab === 'plan' && 'Morning Session - Plan Entry'}\r\n                            {activeTab === 'achievement' && 'Evening Session - Achievement'}\r\n                            {activeTab === 'history' && 'Performance History'}\r\n                        </h2>\r\n                        <p className=\"text-muted\">\r\n                            {activeTab === 'plan' && 'What is your target for today?'}\r\n                            {activeTab === 'achievement' && 'Update your actual business figures'}\r\n                            {activeTab === 'history' && 'Your past performance records'}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {activeTab !== 'history' ? (\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '2rem' }}>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>\r\n                                <div>\r\n                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600, color: '#374151', fontSize: '0.9rem' }}>Date</label>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: '#f3f4f6', padding: '0.75rem', borderRadius: '8px', border: '1px solid #e5e7eb' }}>\r\n                                        <Calendar size={18} color=\"#6b7280\" />\r\n                                        <input\r\n                                            type=\"date\"\r\n                                            value={date}\r\n                                            onChange={(e) => setDate(e.target.value)}\r\n                                            style={{ background: 'transparent', border: 'none', outline: 'none', color: '#111827', width: '100%' }}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600, color: '#374151', fontSize: '0.9rem' }}>Branch Information</label>\r\n                                    <div style={{ padding: '0.75rem', background: '#f9fafb', borderRadius: '8px', border: '1px dashed #d1d5db', color: '#6b7280', fontSize: '0.9rem' }}>\r\n                                        {user.branch} Branch / {user.zone} Zone\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {activeTab === 'plan' && (\r\n                                <div>\r\n                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600, color: '#374151' }}>Daily New Business Plan</label>\r\n                                    <textarea\r\n                                        className=\"clean-input\"\r\n                                        rows={4}\r\n                                        placeholder=\"Describe your plan for today (e.g., maintain relationships, visit client X...)\"\r\n                                        value={record.morning_plan || ''}\r\n                                        onChange={(e) => setRecord({ ...record, morning_plan: e.target.value })}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeTab === 'achievement' && (\r\n                                <div>\r\n                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600, color: '#374151' }}>Actual Business Achieved (LKR)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className=\"clean-input\"\r\n                                        style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#059669' }}\r\n                                        placeholder=\"0.00\"\r\n                                        value={record.actual_business || ''}\r\n                                        onChange={(e) => setRecord({ ...record, actual_business: e.target.value })}\r\n                                    />\r\n                                    <p className=\"text-muted\" style={{ marginTop: '0.5rem' }}>\r\n                                        Enter the total value of new business generated today.\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: '1rem' }}>\r\n                                <button onClick={handleSave} className=\"btn-primary\" style={{ width: 'auto', paddingLeft: '2rem', paddingRight: '2rem' }} disabled={saving}>\r\n                                    {saving ? 'Saving...' : 'Save Record'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div>\r\n                            <table className=\"clean-table\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>Date</th>\r\n                                        <th>Morning Plan</th>\r\n                                        <th>Achievement</th>\r\n                                        <th>Status</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {history.map((h, i) => (\r\n                                        <tr key={i}>\r\n                                            <td style={{ fontWeight: 500 }}>{h.date}</td>\r\n                                            <td style={{ color: '#6b7280', maxWidth: '300px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{h.morning_plan || '-'}</td>\r\n                                            <td style={{ fontWeight: 600, color: h.actual_business > 0 ? '#059669' : '#374151' }}>\r\n                                                {formatCurrency(h.actual_business || 0)}\r\n                                            </td>\r\n                                            <td>\r\n                                                <span style={{\r\n                                                    fontSize: '0.75rem',\r\n                                                    padding: '0.25rem 0.5rem',\r\n                                                    borderRadius: '99px',\r\n                                                    background: h.actual_business ? '#ecfdf5' : '#f3f4f6',\r\n                                                    color: h.actual_business ? '#047857' : '#6b7280',\r\n                                                    fontWeight: 600\r\n                                                }}>\r\n                                                    {h.actual_business ? 'Completed' : 'Pending'}\r\n                                                </span>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                    {history.length === 0 && (\r\n                                        <tr>\r\n                                            <td colSpan=\"4\" style={{ textAlign: 'center', padding: '2rem', color: '#9ca3af' }}>No records found</td>\r\n                                        </tr>\r\n                                    )}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\components\\SignupForm.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":95,"column":40,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select &quot;Zonal Manager\" to manage a specific zone.\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select &ldquo;Zonal Manager\" to manage a specific zone.\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select &#34;Zonal Manager\" to manage a specific zone.\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select &rdquo;Zonal Manager\" to manage a specific zone.\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":95,"column":54,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select \"Zonal Manager&quot; to manage a specific zone.\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select \"Zonal Manager&ldquo; to manage a specific zone.\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select \"Zonal Manager&#34; to manage a specific zone.\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4642,4755],"text":"\r\n                                Select \"Zonal Manager&rdquo; to manage a specific zone.\r\n                            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { Sun, Moon } from 'lucide-react';\r\n\r\nexport default function SignupForm({ onSignup, onSwitch, theme, toggleTheme }) {\r\n    const [formData, setFormData] = useState({\r\n        username: '', password: '', role: 'member', zone: '', branch: ''\r\n    });\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const res = await fetch('/api/auth/signup', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(formData)\r\n            });\r\n            const data = await res.json();\r\n\r\n            if (data.error) throw new Error(data.error);\r\n\r\n            onSignup();\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', background: 'var(--bg-body)', position: 'relative' }}>\r\n            {/* Theme Toggle */}\r\n            <button\r\n                onClick={toggleTheme}\r\n                className=\"btn-secondary\"\r\n                style={{ position: 'absolute', top: '2rem', right: '2rem', borderRadius: '50%', width: '44px', height: '44px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n            >\r\n                {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}\r\n            </button>\r\n\r\n            <div className=\"clean-card animate-fade-in\" style={{ padding: '2.5rem', width: '100%', maxWidth: '480px', background: 'var(--bg-card)' }}>\r\n                <h2 className=\"text-h1\" style={{ marginBottom: '0.5rem', textAlign: 'left', color: 'var(--text-main)' }}>\r\n                    Create Account\r\n                </h2>\r\n                <p className=\"text-muted\" style={{ marginBottom: '2rem', textAlign: 'left' }}>\r\n                    Join the team today\r\n                </p>\r\n\r\n                {error && <div style={{ background: '#fef2f2', border: '1px solid #fee2e2', color: '#b91c1c', padding: '0.75rem', borderRadius: '6px', marginBottom: '1.5rem' }}>{error}</div>}\r\n\r\n                <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\r\n                    <div>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>Username</label>\r\n                        <input\r\n                            className=\"clean-input\"\r\n                            value={formData.username}\r\n                            onChange={(e) => setFormData({ ...formData, username: e.target.value })}\r\n                            required\r\n                            placeholder=\"e.g. john_doe\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>Password</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            className=\"clean-input\"\r\n                            value={formData.password}\r\n                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                            required\r\n                            placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>Role</label>\r\n                        <select\r\n                            className=\"clean-input\"\r\n                            value={formData.role}\r\n                            onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                            style={{ background: 'white' }}\r\n                        >\r\n                            <option value=\"member\">Team Member</option>\r\n                            <option value=\"zonal_manager\">Zonal Manager</option>\r\n                            <option value=\"head\">Department Head</option>\r\n                            <option value=\"admin\">Admin</option>\r\n                        </select>\r\n                        {formData.role === 'zonal_manager' &&\r\n                            <p className=\"text-muted\" style={{ fontSize: '0.75rem', marginTop: '0.5rem' }}>\r\n                                Select \"Zonal Manager\" to manage a specific zone.\r\n                            </p>\r\n                        }\r\n                    </div>\r\n\r\n                    {/* Only show Zone/Branch input for Zonal Manager or Admin/Heads if needed. */}\r\n                    {formData.role !== 'member' && (\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>Zone</label>\r\n                                <input\r\n                                    className=\"clean-input\"\r\n                                    placeholder=\"e.g. West\"\r\n                                    value={formData.zone}\r\n                                    onChange={(e) => setFormData({ ...formData, zone: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: 600, color: '#374151' }}>Branch</label>\r\n                                <input\r\n                                    className=\"clean-input\"\r\n                                    placeholder=\"e.g. NYC\"\r\n                                    value={formData.branch}\r\n                                    onChange={(e) => setFormData({ ...formData, branch: e.target.value })}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {formData.role === 'member' && (\r\n                        <p style={{ fontSize: '0.875rem', color: '#6b7280', textAlign: 'center', background: '#f3f4f6', padding: '0.75rem', borderRadius: '8px' }}>\r\n                            Your Zone and Branch will be assigned by the Admin after registration.\r\n                        </p>\r\n                    )}\r\n\r\n                    <button type=\"submit\" className=\"btn-primary\" style={{ marginTop: '0.5rem' }} disabled={loading}>\r\n                        {loading ? 'Creating...' : 'Sign Up'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div style={{ marginTop: '2rem', textAlign: 'center', fontSize: '0.875rem', color: '#6b7280' }}>\r\n                    Already have an account?{' '}\r\n                    <button\r\n                        onClick={onSwitch}\r\n                        className=\"text-link\"\r\n                        style={{ background: 'none', border: 'none' }}\r\n                    >\r\n                        Login\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\components\\ZonalManagerDashboard.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecords'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [locations, date, fetchRecords]","fix":{"range":[942,959],"text":"[locations, date, fetchRecords]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport { Save, Calendar, BarChart2, Shield, LogOut, Sun, Moon } from 'lucide-react';\r\n\r\nexport default function ZonalManagerDashboard({ user, onLogout, theme, toggleTheme }) {\r\n    const [activeTab, setActiveTab] = useState('plan'); // plan, achievement, summary\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [locations, setLocations] = useState([]);\r\n    const [records, setRecords] = useState({});\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        try {\r\n            const parsed = user.managed_locations ? JSON.parse(user.managed_locations) : [];\r\n            setLocations(parsed);\r\n        } catch (e) {\r\n            setLocations([]);\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (locations.length > 0) fetchRecords();\r\n    }, [locations, date]);\r\n\r\n    const fetchRecords = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/records?userId=${user.id}&date=${date}`);\r\n            const data = await res.json();\r\n\r\n            const recordsMap = {};\r\n            if (Array.isArray(data)) {\r\n                data.forEach(r => {\r\n                    const key = `${r.zone}-${r.branch}`;\r\n                    recordsMap[key] = r;\r\n                });\r\n            }\r\n            setRecords(recordsMap);\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleInputChange = (zone, branch, field, value) => {\r\n        const key = `${zone}-${branch}`;\r\n        setRecords(prev => ({\r\n            ...prev,\r\n            [key]: {\r\n                ...prev[key],\r\n                [field]: value,\r\n                zone,\r\n                branch\r\n            }\r\n        }));\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            const promises = locations.map(loc => {\r\n                const key = `${loc.zone}-${loc.branch}`;\r\n                const record = records[key] || {};\r\n\r\n                return fetch('/api/records', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        user_id: user.id,\r\n                        date,\r\n                        morning_plan: record.morning_plan,\r\n                        actual_business: parseFloat(record.actual_business) || 0,\r\n                        zone: loc.zone,\r\n                        branch: loc.branch\r\n                    })\r\n                });\r\n            });\r\n\r\n            await Promise.all(promises);\r\n            alert('Records saved successfully!');\r\n            fetchRecords();\r\n        } catch (e) {\r\n            alert('Error saving records');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (val) => {\r\n        return new Intl.NumberFormat('en-LK', { style: 'currency', currency: 'LKR', minimumFractionDigits: 0 }).format(val);\r\n    };\r\n\r\n    return (\r\n        <div style={{ minHeight: '100vh', background: 'var(--bg-body)' }}>\r\n            {/* Top Navigation Bar */}\r\n            <header className=\"dashboard-header\" style={{ background: 'var(--bg-card)' }}>\r\n                <div>\r\n                    <h1 className=\"text-h1\">Daily Business Tracker</h1>\r\n                    <p className=\"text-muted\">Zone-wise New Business Management System</p>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>\r\n                    <button\r\n                        onClick={toggleTheme}\r\n                        className=\"btn-secondary\"\r\n                        style={{ padding: '0.5rem', borderRadius: '50%', width: '40px', height: '40px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n                    >\r\n                        {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}\r\n                    </button>\r\n\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'rgba(59, 130, 246, 0.1)', padding: '0.5rem 1rem', borderRadius: '20px', color: 'var(--accent-blue)' }}>\r\n                        <Shield size={16} />\r\n                        <span style={{ fontSize: '0.85rem', fontWeight: 600 }}>Zonal Manager Access</span>\r\n                    </div>\r\n\r\n                    <div style={{ textAlign: 'right' }}>\r\n                        <div style={{ fontSize: '0.9rem', fontWeight: 600 }}>{user.username}</div>\r\n                        <div style={{ fontSize: '0.75rem', color: '#6b7280' }}>{locations.length} Branches</div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={onLogout}\r\n                        className=\"btn-secondary\"\r\n                        style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 0.75rem' }}\r\n                    >\r\n                        <LogOut size={16} /> Logout\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem' }}>\r\n\r\n                {/* Tabs */}\r\n                <div className=\"nav-tabs\">\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'plan' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('plan')}\r\n                    >\r\n                        <Sun size={18} /> Morning - Plan Entry\r\n                    </button>\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'achievement' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('achievement')}\r\n                    >\r\n                        <Moon size={18} /> Evening - Achievement Entry\r\n                    </button>\r\n                    <button\r\n                        className={`nav-tab ${activeTab === 'summary' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('summary')}\r\n                    >\r\n                        <BarChart2 size={18} /> Summary & Analytics\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content Card */}\r\n                <div className=\"clean-card animate-fade-in\">\r\n                    <div className=\"card-header-accent\">\r\n                        <h2 className=\"text-h2\" style={{ marginBottom: '0.25rem' }}>\r\n                            {activeTab === 'plan' && 'Morning Session - Daily Plan Entry'}\r\n                            {activeTab === 'achievement' && 'Evening Session - Business Achievement'}\r\n                            {activeTab === 'summary' && 'Daily Summary Overview'}\r\n                        </h2>\r\n                        <p className=\"text-muted\">\r\n                            {activeTab === 'plan' && 'Enter your daily new business plan for today'}\r\n                            {activeTab === 'achievement' && 'Update the actual new business figures achieved'}\r\n                            {activeTab === 'summary' && 'Review performance across all allocated branches'}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div style={{ marginBottom: '2rem', display: 'flex', gap: '2rem', alignItems: 'center' }}>\r\n                        <div>\r\n                            <label style={{ display: 'block', fontSize: '0.85rem', fontWeight: 600, marginBottom: '0.5rem' }}>Select Date</label>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: '#f3f4f6', padding: '0.5rem 1rem', borderRadius: '8px', border: '1px solid #e5e7eb' }}>\r\n                                <Calendar size={18} color=\"#6b7280\" />\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={date}\r\n                                    onChange={(e) => setDate(e.target.value)}\r\n                                    style={{ background: 'transparent', border: 'none', outline: 'none', fontSize: '0.9rem', color: '#111827' }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {locations.length === 0 ? (\r\n                        <div style={{ padding: '3rem', textAlign: 'center', color: '#6b7280', background: '#f9fafb', borderRadius: '8px' }}>\r\n                            No branches assigned. Please contact Administrator.\r\n                        </div>\r\n                    ) : (\r\n                        <div>\r\n                            {/* Table Header */}\r\n                            <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr 1fr', padding: '0.75rem 1rem', borderBottom: '2px solid #f3f4f6', background: '#f9fafb', fontWeight: 600, fontSize: '0.85rem', color: '#6b7280', textTransform: 'uppercase' }}>\r\n                                <div>Zone / Branch Details</div>\r\n                                <div>{activeTab === 'plan' ? 'New Business Plan' : 'Morning Plan'}</div>\r\n                                <div>{activeTab === 'achievement' ? 'Actual Achievement (LKR)' : (activeTab === 'summary' ? 'Achievement' : 'Status')}</div>\r\n                            </div>\r\n\r\n                            {locations.map((loc, idx) => {\r\n                                const key = `${loc.zone}-${loc.branch}`;\r\n                                const rec = records[key] || {};\r\n\r\n                                return (\r\n                                    <div key={idx} style={{\r\n                                        display: 'grid',\r\n                                        gridTemplateColumns: '2fr 1fr 1fr',\r\n                                        padding: '1rem',\r\n                                        alignItems: 'center',\r\n                                        borderBottom: '1px solid #f3f4f6',\r\n                                        background: idx % 2 === 0 ? 'white' : '#fafafa'\r\n                                    }}>\r\n                                        <div>\r\n                                            <div style={{ fontSize: '0.8rem', color: '#3b82f6', fontWeight: 600 }}>{loc.zone}</div>\r\n                                            <div style={{ fontSize: '1rem', fontWeight: 500 }}>{loc.branch} Branch</div>\r\n                                        </div>\r\n\r\n                                        {/* Morning Plan Column */}\r\n                                        <div style={{ paddingRight: '1rem' }}>\r\n                                            {activeTab === 'plan' ? (\r\n                                                <input\r\n                                                    className=\"clean-input\"\r\n                                                    placeholder=\"Enter plan description...\"\r\n                                                    value={rec.morning_plan || ''}\r\n                                                    onChange={(e) => handleInputChange(loc.zone, loc.branch, 'morning_plan', e.target.value)}\r\n                                                />\r\n                                            ) : (\r\n                                                <span style={{ color: '#6b7280', fontSize: '0.9rem' }}>\r\n                                                    {rec.morning_plan || '-'}\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Actual Achievement Column */}\r\n                                        <div>\r\n                                            {activeTab === 'achievement' ? (\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    className=\"clean-input\"\r\n                                                    placeholder=\"0.00\"\r\n                                                    style={{ fontWeight: 600, color: '#059669' }}\r\n                                                    value={rec.actual_business || ''}\r\n                                                    onChange={(e) => handleInputChange(loc.zone, loc.branch, 'actual_business', e.target.value)}\r\n                                                />\r\n                                            ) : (\r\n                                                activeTab === 'summary' ? (\r\n                                                    <span style={{ fontWeight: 600, color: (rec.actual_business > 0) ? '#059669' : '#6b7280' }}>\r\n                                                        {formatCurrency(rec.actual_business || 0)}\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span style={{ fontSize: '0.8rem', padding: '0.25rem 0.5rem', background: '#f3f4f6', borderRadius: '4px', color: '#6b7280' }}>Pending Evening Entry</span>\r\n                                                )\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab !== 'summary' && locations.length > 0 && (\r\n                        <div style={{ marginTop: '2rem', display: 'flex', justifyContent: 'flex-end' }}>\r\n                            <button\r\n                                onClick={handleSave}\r\n                                disabled={saving}\r\n                                className=\"btn-primary\"\r\n                                style={{ width: 'auto', paddingLeft: '2rem', paddingRight: '2rem' }}\r\n                            >\r\n                                {saving ? (\r\n                                    'Saving...'\r\n                                ) : (\r\n                                    <>\r\n                                        <Save size={18} style={{ marginRight: '0.5rem' }} />\r\n                                        Save {activeTab === 'plan' ? 'Plans' : 'Achievements'}\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab === 'summary' && locations.length > 0 && (\r\n                        <div style={{ marginTop: '2rem', padding: '1rem', background: '#f0f9ff', borderRadius: '8px', border: '1px solid #bae6fd' }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                <span style={{ color: '#0369a1', fontWeight: 600 }}>Total Zone Achievement Today</span>\r\n                                <span style={{ fontSize: '1.25rem', fontWeight: 700, color: '#0284c7' }}>\r\n                                    {formatCurrency(Object.values(records).reduce((acc, r) => acc + (parseFloat(r.actual_business) || 0), 0))}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\lib\\db.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\Daily New Business Tracker\\daily-tracker\\src\\lib\\supabase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
